const dataStore={routeList:{},routeBase:null,root:null,data:{},originalHTML:null,currHTML:"",baseUrl:"",appendedScripts:[],renderList:[],setData:function(t){Object.assign(this.data,t),this.updateParts()},get:function(t){return this.data[t]},storeRenderList:function(){this.renderList=[],this.root.querySelectorAll("[data-render]").forEach(t=>{this.renderList.push({elm:t,rawHTML:t.innerHTML})})},removeAppendedTempScripts:function(){this.appendedScripts.forEach(t=>t.remove()),this.appendedScripts.length=0},executeScript:function(){this.removeAppendedTempScripts();let t=root.querySelectorAll("script");t.forEach(t=>{let e=document.createElement("script");e.textContent=t.textContent;let r=Function(e.textContent);r(),document.body.appendChild(e),this.appendedScripts.push(e)})},evaluateCondition:function(condition){Object.keys(this.data).forEach(t=>{let e=this.data[t];condition=condition.replace(RegExp(`\\b${t}\\b`,"g"),JSON.stringify(e))});try{return eval(condition)}catch(e){return console.error("Condition evaluation error:",e),!1}},update:function(t,e){this.data[t]=e,this.updateParts()},updateParts:function(){let t=/{{\s*(\w+)\s*}}/g,e=/{{#if\s+\((.*?)\)}}([\s\S]*?){{\/if}}/g,r=/{{#each\s+(\w+)\s*}}([\s\S]*?){{\/each}}/g;this.renderList.forEach(a=>{let o=a.rawHTML;o=(o=(o=o.replace(r,(t,e,r)=>Array.isArray(this.data[e])?this.data[e].map(t=>r.replace(/{{\s*(\w+)\s*}}/g,(e,r)=>void 0!==t[r]?t[r]:"")).join(""):"")).replace(e,(t,e,r)=>this.evaluateCondition(e)?r:"")).replace(t,(t,e)=>void 0!==this.data[e]?this.data[e]:""),a.elm.innerHTML=o})},renderHTML:function(){this.root&&(this.root.innerHTML=this.currHTML)},setRoutes:function(){let t={};document.querySelectorAll(".async-link").forEach(e=>{e.hasAttribute("page-target")&&(t[e.getAttribute("href")]=e.getAttribute("page-target"))}),this.routeList={...this.routeList,...Object.entries(t).map(([t,e])=>({[t]:e}))}}},renderPage=t=>fetch(`${dataStore.routeBase}/${t}`).then(t=>t.text()).then(t=>{dataStore.currHTML=t,dataStore.renderHTML(),dataStore.storeRenderList(),dataStore.executeScript(),dataStore.setRoutes()}).catch(t=>console.error("Error fetching data:",t)),loadPage=t=>{window.history.pushState("","",`${dataStore.baseUrl}#${t}`);let e=dataStore.routeList[t];return dataStore.routeList.hasOwnProperty(t)||(e=`${t}.html`),renderPage(e)},getBaseUrl=()=>window.location.pathname,setDOM=(t,e)=>{let r=e.defaultPage;return dataStore.root=t,dataStore.routeBase=e.base_dir,dataStore.routeList=e.route||[],dataStore.baseUrl=getBaseUrl(),loadPage(r).then(()=>{dataStore.setRoutes()})};function removeAllScriptsFromBody(){let t=document.body.querySelectorAll("script");t.forEach(t=>t.remove())}document.body.addEventListener("click",function(t){if(t.target.matches("a.async-link")){t.preventDefault();let e=t.target.getAttribute("href");loadPage(e)}});